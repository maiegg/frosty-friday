**This is a nice practice with inferring JSON structure from an unknown file - slightly tedious but useful!**

First load the data:
```
create or replace stage s3_data 
	URL = 's3://frostyfridaychallenges/challenge_25/' ;

create or replace table weather_raw (
    rawdata variant 
);

copy into weather_raw 
from @s3_data 
file_format = (type='JSON');
```

I used this builtin function to infer the top-level keys:
```
select object_keys(rawdata) from weather_raw;
```

And the same in combination with `lateral flatten` to infer the next level down. Fortunately, there are only two levels.
```
select object_keys(value)
from weather_raw
, LATERAL FLATTEN(input => PARSE_JSON(rawdata):weather);

select object_keys(value)
from weather_raw
, LATERAL FLATTEN(input => PARSE_JSON(rawdata):sources);
```

From there, it's a very simple matter of selecting the elements you want (below) and aggregating them (skipped repeating that since it's simple). 
```
create or replace table weather_curated as 
select value:timestamp::timestamp as timestamp
, date(value:timestamp::timestamp) as timestamp_date
, value:temperature::number as temperature
, value:precipitation::number as precipitation
, value:wind_speed::number as wind_speed
, value:relative_humidity::int as relative_humidity 
, value:icon::text as icon 
from weather_raw
, LATERAL FLATTEN(input => PARSE_JSON(rawdata):weather);
```

